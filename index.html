<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.js"></script>
    <style>
        html, body {margin: 0; padding: 0;}
        body{font-family:Helvetica, Arial, sans-serif;}
        select {position: absolute; right: 4%; top: 4%;}
        canvas {display: block;}
    </style>
    <title>DNO037 - CLASE 3</title>
</head>

<body>

    <select onchange="if (this.value) window.location.href=this.value">
        <option value="index.html" selected>Casos confirmados</option>
        <option value="page.html">Temblores +4.5M</option>
    </select>

    <script>
        var url = "https://pomber.github.io/covid19/timeseries.json";
        // Aunque se actualiza tres veces al día, existe una demora en el conteo.
        // Porque depende de otra fuente de datos que, a su vez, espera todos los comunicados oficiales para actualizar.
        // Revisar - https://github.com/pomber/covid19

        var casos, indonesios;

        function preload() {
            casos = loadJSON(url);
        }

        function setup() {
            noLoop(); // Esta función afectará al draw(). No se redibujará, solo se dibujará una vez.
            createP(url).position(27,18).style('font-size', 12+"px"); // Creo un párrafo cuyo texto es el contenido de la variable url
            createCanvas(windowWidth, windowHeight).position(0, 0).style('z-index', -1);
            /*
                A continuación voy a buscar el nombre Chile en el objeto contenido en la variable casos.
                Chile se escribe igual en castellano e inglés, no así Japan, Philippines, Russia, etc.
                El resultado de la búsqueda es lo que asigno como contenido a la variable chilenos.
            */
            indonesios = casos.Indonesia;
            console.log("Casos confirmados:");
        }

        function draw() {
            colorMode(HSB, 360, 100, 100);
            background(random(0, 360), 50, 100);
            /*
                A continuación, mediante un ciclo for, imprimiré los números de casos informados por la autoridad en distintas fechas, a condición de que los casos sean distintos de 0. Pueden asomarse a la Consola de JavaScript para ver el resultado y evolución en el tiempo.
            */
            for (var i = 0; i < indonesios.length; i++) {
                if (indonesios[i].confirmed != 0) {
                    console.log(indonesios[i].confirmed.toLocaleString('es-ES') + " @ " + indonesios[i].date); // Uso la función toLocaleString para tener miles con punto, por defecto no los tendría.
                }
            }

            textSize(24);
            textAlign(CENTER);
            text("Hasta el día de ayer, había " + indonesios[indonesios.length - 1].confirmed.toLocaleString('es-ES') + " casos confirmados de COVID-19 en Indonesia.", width / 2, height / 2);
            /*
                En la línea de arriba creo un texto dentro del canvas (ya creado en línea 39).
                Esto NO es lo mismo que crear un párrafo fuera del canvas.
                Inspecciona elementos en tu navegador para aclarar la diferencia.
            */
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
        /*
			Debes modificar todo lo que sea necesario modificar para que tu versión de este ejercicio corresponda íntegramente con los datos correspondientes a un país distinto de Chile.
        */
    </script>
</body>

</html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.js"></script>
    <style>
        html, body {margin: 0; padding: 0;}
        body{font-family:Helvetica, Arial, sans-serif;}
        select {position: absolute; right: 4%; top: 4%;}
        canvas {display: block;}
    </style>
    <title>DNO037 - CLASE 3</title>
</head>

<body>

    <select onchange="if (this.value) window.location.href=this.value">
        <option value="index.html">Casos confirmados</option>
        <option value="page.html" selected>Temblores +4.5M</option>
    </select>

    <script>
        var url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.geojson";
        // Existe una demora de 5 minutos en su actualización
        // Revisar - https://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php

        var temblores;
        var indonesios = [];

        function preload() {
            temblores = loadJSON(url);
        }

        function setup() {
            noLoop(); // Esta función afectará al draw(). No se redibujará, solo se dibujará una vez.
            createP(url).position(27,18).style('font-size', 12+"px"); // Creo un párrafo cuyo texto es el contenido de la variable url
            createCanvas(windowWidth, windowHeight).position(0, 0).style('z-index', -1);
            console.log("Arreglo de temblores registrados:");
            /*
                A continuación exploraré la variable temblores con un ciclo (for).
                Esta variable ya tiene, a la manera que sirve a JavaScript, lo del JSON.
                En la exploración preguntaré a cada evento si acaso incluye "Chile".
                Si lo incluye, se toma la descripción del evento y se mete al arreglo chilenos.
            */
            for (var n = 0; n < temblores.features.length; n++) {
                if (temblores.features[n].properties.place.includes("Indonesia")) {
                    indonesios.push(temblores.features[n].properties);
                }
            }
            console.log(indonesios); // Pueden ver en la consola el arreglo resultante
            console.log("El más reciente fue el de " + indonesios[0].title + " — " + indonesios[0].url);
        }

        function draw() {
            colorMode(HSB, 360, 100, 100);
            background(random(0, 360), 50, 100);
            textSize(24);
            textAlign(CENTER);
            text("Hay " + indonesios.length + " temblores +4.5M registrados el último mes en Indonesia.", width / 2, height / 2);
            /*
                En la línea de arriba creo un texto dentro del canvas (ya creado en línea 39).
                Esto NO es lo mismo que crear un párrafo fuera del canvas.
                Inspecciona elementos en tu navegador para aclarar la diferencia.
            */
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>

</html>

